{"content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  const privateKey = \"Team 6 Andromedia\";\n  let a_post = {\n    email: req.body.email,\n    pass: req.body.password,\n  };\n  const dataLogin = db.muser.findUnique({\n    where: {\n      email: a_post.email,\n    },\n    select: {\n      id: true,\n      email: true,\n      password: true,\n      muser_detail: true,\n      muser_role: true,\n    },\n  });\n  dataLogin.then((e) => {\n    if (e != null) {\n      if (\n        a_post.pass ==\n        ext.CryptoJS.AES.decrypt(e.password, privateKey).toString(\n          ext.CryptoJS.enc.Utf8\n        )\n      ) {\n        let token_private = ext.CryptoJS.SHA3(privateKey, {\n          outputLength: 512,\n        }).toString();\n        let in_data = {\n          id: e.id,\n          email: e.email,\n          muser_detail: e.muser_detail,\n          muser_role: e.muser_role.name,\n          token: token_private,\n          ip: ext.address.ip(),\n        };\n        let stringdata = JSON.stringify(in_data);\n        let id_user = ext.CryptoJS.AES.encrypt(\n          stringdata,\n          token_private\n        ).toString();\n        user.user.id = id_user;\n        const data = db.muser.findUnique({\n          where: {\n            email: a_post.email,\n          },\n          select: {\n            email: true,\n            muser_role: {\n              select: {\n                name: true,\n              },\n            },\n          },\n        });\n        data.then((e) => {\n          reply.send({\n            status: true,\n            data_act: e,\n          });\n        });\n      } else {\n        reply.send({\n          status: false,\n          msg: \"password invalid\",\n        });\n      }\n    } else {\n      reply.send({\n        status: false,\n        msg: \"data not found\",\n      });\n    }\n  })\n}","figma":{}},"title":"login","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"54643","slug":"/api/login","site":"*","id":"46513"}